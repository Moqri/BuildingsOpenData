<html>
<head>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
</head>

<body>
<table id="t1" border="1"></table>


<script>
function parse(val) {
    var result ,
        tmp = [];
    location.search
    //.replace ( "?", "" ) 
    // this is better, there might be a question mark inside
    .substr(1)
        .split("&")
        .forEach(function (item) {
        tmp = item.split("=");
        if (tmp[0] === val) result = decodeURIComponent(tmp[1]);
    });
    return result;
}
var q = parse('q');
var parcel_id = parse('parcel_id')
var physical_address = parse('physical_address')
var owner_name = parse('owner_name')
console.log(q)

$.ajaxSetup({ cache: true });
var url = ""
if (q) {
    url="http://buildingsopendata.org/api/action/datastore_search?resource_id=78c1ef71-9bb6-4e8a-afde-c74514d47f64&q="+q+"&callback=?"
}else{
    if (parcel_id){
    url="http://buildingsopendata.org/api/action/datastore_search?resource_id=78c1ef71-9bb6-4e8a-afde-c74514d47f64&q={\"PARCEL_ID\":\""+parcel_id+"\"}&callback=?"
    }
    if (physical_address){
    url="http://buildingsopendata.org/api/action/datastore_search?resource_id=78c1ef71-9bb6-4e8a-afde-c74514d47f64&q={\"PHY_ADDR1\":\""+physical_address+"\"}&callback=?"  
    }    
    if (owner_name){
    url="http://buildingsopendata.org/api/action/datastore_search?resource_id=78c1ef71-9bb6-4e8a-afde-c74514d47f64&q={\"OWN_NAME\":\""+owner_name+"\"}&callback=?"  
    }
console.log(url)
}
$.getJSON(url,
function(json){
  console.log(json);
  var data = JSON.stringify(json)
  var obj = $.parseJSON(data);
  //alert(obj['result']['records'][1]['PHY_ADDR1']);
    var tbl_body = "";
    var odd_even = false;
    //header - not the best way to write it
    var tbl_head ="";
    tbl_head += "<th> Parcel ID </th>";
    tbl_head += "<th> Parcel Address </th>";
    tbl_head += "<th> Parcel Owner </th>";
    tbl_body += "<tr>"+tbl_head+"</tr>";

    $.each(obj['result']['records'], function(index, value) {
        var tbl_row = "";
        var parcel_id=value['PARCEL_ID'];
        var physical_address=value['PHY_ADDR1'];
        var physical_address2=value['PHY_ADDR2'];

        var owner_name=value['OWN_NAME'];    
        var owner_address=value['OWN_ADDR1'];    
        var owner_city=value['OWN_CITY'];
        var owner_state=value['OWN_STATE'];    
        var owner_zip=value['OWN_ZIPCD']||'';    


        tbl_row += "<td><a href=\"index.html?parcel_id="+parcel_id+"\"</a>"+parcel_id+"</td>";
        tbl_row +="<td><a href=\"index.html?physical_address="+physical_address+"\"</a>"+physical_address+' '+physical_address2+"</td>";

        tbl_row +="<td><a href=\"index.html?owner_name="+owner_name+"\"</a>"+owner_name+' ('+owner_address+', '+owner_city+', '+ owner_state+' '+owner_zip+")</td>";

        tbl_body += "<tr class=\""+( odd_even ? "odd" : "even")+"\">"+tbl_row+"</tr>";
    })
    $("#t1").html(tbl_body);
});

</script>
</body>
</html>

